<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>My Sell Status - CarRentalPro</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}

body{
  background:#151320;
  color:white;
  padding:30px 18px;
  min-height:100vh;
}

.container{
  max-width:1100px;
  margin:auto;
  background:#1c1830;
  border:1px solid #2a2545;
  border-radius:18px;
  box-shadow:0 30px 70px rgba(0,0,0,0.6);
  padding:22px;
}

.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  gap:12px;
  border-bottom:1px solid #2a2545;
  padding-bottom:16px;
  margin-bottom:18px;
}

h2{color:#9b7cff;font-size:22px;}
.sub{color:#aaa;font-size:13px;margin-top:5px;}

.btn{
  padding:10px 14px;
  border-radius:10px;
  border:1px solid #3a3558;
  background:transparent;
  color:white;
  cursor:pointer;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:16px;
  margin-top:16px;
}

.card{
  background:#17132a;
  border:1px solid #2a2545;
  border-radius:16px;
  padding:14px;
}

.card img{
  width:100%;
  height:170px;
  object-fit:cover;
  border-radius:10px;
}

.status{
  display:inline-block;
  padding:6px 10px;
  border-radius:999px;
  font-size:12px;
  margin-top:8px;
}

.pending{background:rgba(241,196,15,0.12);border:1px solid rgba(241,196,15,0.35);color:#ffeaa7;}
.approved{background:rgba(46,204,113,0.12);border:1px solid rgba(46,204,113,0.35);color:#7CFFB0;}
.rejected{background:rgba(231,76,60,0.12);border:1px solid rgba(231,76,60,0.35);color:#ffb3b3;}

.info{
  margin-top:10px;
  font-size:13px;
  color:#cfcfcf;
  line-height:1.6;
}
.info b{color:white;}

.empty{
  text-align:center;
  margin-top:30px;
  color:#aaa;
}
</style>
</head>

<body>

<div class="container">

<div class="topbar">
  <div>
    <h2>My Sell Requests</h2>
    <div class="sub">Check approval status for cars you submitted to sell ‚úÖ</div>
  </div>
  <button class="btn" onclick="window.location.href='../home/home.html'">‚Üê Back Home</button>
</div>

<div id="grid" class="grid"></div>
<div id="empty" class="empty" style="display:none;">
No sell requests yet üöó
</div>

</div>


<script>

const API = "http://127.0.0.1:3000";


// üî• LOGIN PROTECTION
const user = JSON.parse(localStorage.getItem("car_rental_user"));

if(!user || !user.email){
  alert("Please login first ‚ùå");
  window.location.href="../login/login.html";
}


const grid = document.getElementById("grid");
const empty = document.getElementById("empty");


// SAFE IMAGE
function getImage(imagesStr){
  try{
    const arr = JSON.parse(imagesStr || "[]");
    return arr.length
      ? arr[0]
      : "https://via.placeholder.com/400x200?text=No+Image";
  }catch{
    return "https://via.placeholder.com/400x200?text=No+Image";
  }
}



// STATUS COLOR
function getStatusClass(status){

  if(status === "Approved") return "approved";
  if(status === "Rejected") return "rejected";

  return "pending";
}



// FETCH SELL STATUS
async function loadStatus(){

  try{

    const res = await fetch(
      `${API}/my-selling-status/${user.email}`
    );

    if(!res.ok){
      throw new Error("API Failed");
    }

    const data = await res.json();

    if(!data.success || data.cars.length === 0){
      empty.style.display="block";
      return;
    }

    data.cars.forEach(car => {

      const img = getImage(car.images);

      grid.innerHTML += `
        <div class="card">

          <img src="${img}">

          <h3>${car.company || "-"} ${car.model || ""}</h3>

          <span class="status ${getStatusClass(car.status)}">
            ${car.status}
          </span>

          <div class="info">

            <div><b>Price:</b> ‚Çπ${car.selling_price || 0}</div>

            <div><b>Year:</b> ${car.year || "-"}</div>

            <div><b>KM:</b> ${car.km || "-"}</div>

            <div><b>Fuel:</b> ${car.fuel || "-"}</div>

            <div><b>Location:</b> ${car.location || "-"}</div>

          </div>

        </div>
      `;
    });

  }catch(err){

    console.error(err);
    empty.style.display="block";
    empty.innerText="Unable to load status ‚ùå";

  }
}


loadStatus();

</script>

</body>
</html>
