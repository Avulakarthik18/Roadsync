<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Car Rental System - Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{height:100vh;background:#151320;display:flex;justify-content:center;align-items:center;}
.container{width:90%;max-width:1200px;height:650px;display:flex;background:#1c1830;border-radius:18px;overflow:hidden;box-shadow:0 30px 70px rgba(0,0,0,0.6);}
.left-section{width:50%;background:url("login_car_bg.jpeg") center/cover no-repeat;position:relative;}
.overlay{position:absolute;inset:0;background:linear-gradient(120deg, rgba(0,0,0,0.35), rgba(0,0,0,0.75));}
.right-section{width:50%;padding:60px;color:white;}
.right-section h2{font-size:34px;}
.subtitle{color:#aaa;margin-bottom:30px;}
form input{width:100%;padding:14px;background:#2a2545;border:none;border-radius:10px;color:white;margin-bottom:18px;font-size:15px;}
form input::placeholder{color:#aaa;}
.options{display:flex;justify-content:space-between;font-size:14px;margin-bottom:25px;}
.options a{color:#9b7cff;text-decoration:none;}
.remember-me{display:flex;align-items:center;gap:8px;cursor:pointer;}
.remember-me input{margin:0;width:16px;height:16px;accent-color:#9b7cff;}
.login-btn{width:100%;padding:14px;background:linear-gradient(135deg,#7f5cff,#9b7cff);border:none;border-radius:12px;color:white;font-size:16px;cursor:pointer;margin-bottom:20px;}
.signup-link{text-align:center;font-size:14px;}
.signup-link a{color:#9b7cff;text-decoration:none;}
.status{display:none;text-align:center;margin-top:10px;font-size:14px;background:#2a2545;padding:10px;border-radius:10px;color:#cfcfcf;}
</style>
</head>

<body>

<div class="container">
  <div class="left-section"><div class="overlay"></div></div>

  <div class="right-section">
    <h2>Login</h2>
    <p class="subtitle">User/Admin Login ✅</p>

    <form id="loginForm">
      <input type="email" id="email" placeholder="Email" required>
      <input type="password" id="password" placeholder="Password" required>

      <div class="options">
        <label class="remember-me">
          <input type="checkbox" id="remember">
          <span>Remember me</span>
        </label>
        <a href="forgot_password/forgot_password.html">Forgot password?</a>
      </div>

      <button class="login-btn" type="submit">Login</button>
      <div class="status" id="statusMsg"></div>

      <p class="signup-link">
        Don’t have an account? <a href="signup/signup.html">Sign up</a>
      </p>
    </form>
  </div>
</div>

<script>
document.getElementById("loginForm").addEventListener("submit", async (e)=>{
  e.preventDefault();

  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const statusMsg = document.getElementById("statusMsg");
  statusMsg.style.display = "none";

  try{
    const res = await fetch("http://127.0.0.1:3000/login",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({email,password})
    });

    const text = await res.text();
let data;

try{
  data = JSON.parse(text);
}catch{
  console.error("Non JSON response:", text);
  throw new Error("Server returned HTML instead of JSON");
}
    statusMsg.style.display = "block";
    statusMsg.innerText = data.message;

    if(data.success){
      localStorage.setItem("car_rental_user", JSON.stringify({
        loggedIn:true,
        email:data.user.email,
        first_name:data.user.first_name,
        last_name:data.user.last_name,
        role:data.role
      }));

      setTimeout(()=>{
        if(data.role === "admin"){
  window.location.href = "../admin/admin_choice.html";
}else{
          window.location.href = "../home/home.html";
        }
      }, 900);
    }

  }catch(err){
    statusMsg.style.display = "block";
    statusMsg.innerText = "Server error ❌ Backend not running";
  }
});
</script>

</body>
</html>
